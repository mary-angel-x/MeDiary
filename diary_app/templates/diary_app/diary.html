{% extends 'diary_app/base.html' %}

{% block title %}–ú–æ–π –¥–Ω–µ–≤–Ω–∏–∫ - MeMind{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="mb-8">
        <h1 class="text-5xl font-bold mb-4 outlined-text" style="-webkit-text-stroke: 3px black; color: white;">
            –ú–û–ô –î–ù–ï–í–ù–ò–ö
        </h1>
        <div class="wavy-line w-48 mb-6"></div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="text-center">
                <p class="text-3xl font-bold text-black">{{ total_entries }}</p>
                <p class="text-lg text-gray-700">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</p>
            </div>
            <div class="text-center">
                <p class="text-3xl font-bold text-black">{{ favorite_count }}</p>
                <p class="text-lg text-gray-700">–ò–∑–±—Ä–∞–Ω–Ω—ã—Ö</p>
            </div>
            <div class="text-center">
                <p class="text-3xl font-bold text-black">{{ today_entries }}</p>
                <p class="text-lg text-gray-700">–°–µ–≥–æ–¥–Ω—è</p>
            </div>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class="card mb-6">
        <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <input type="text" name="search" value="{{ search_query }}" 
                   placeholder="–ü–æ–∏—Å–∫..." class="form-input">
            
            <select name="mood" class="form-select">
                <option value="">–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</option>
                <option value="happy" {% if mood_filter == 'happy' %}selected{% endif %}>üòä –°—á–∞—Å—Ç–ª–∏–≤—ã–π</option>
                <option value="sad" {% if mood_filter == 'sad' %}selected{% endif %}>üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π</option>
                <option value="excited" {% if mood_filter == 'excited' %}selected{% endif %}>ü§© –í–∑–≤–æ–ª–Ω–æ–≤–∞–Ω–Ω—ã–π</option>
                <option value="calm" {% if mood_filter == 'calm' %}selected{% endif %}>üòå –°–ø–æ–∫–æ–π–Ω—ã–π</option>
                <option value="anxious" {% if mood_filter == 'anxious' %}selected{% endif %}>üò∞ –¢—Ä–µ–≤–æ–∂–Ω—ã–π</option>
                <option value="grateful" {% if mood_filter == 'grateful' %}selected{% endif %}>üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω—ã–π</option>
                <option value="tired" {% if mood_filter == 'tired' %}selected{% endif %}>üò¥ –£—Å—Ç–∞–ª—ã–π</option>
                <option value="motivated" {% if mood_filter == 'motivated' %}selected{% endif %}>üí™ –ú–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
            </select>
            
            <select name="favorite" class="form-select">
                <option value="">–í—Å–µ –∑–∞–ø–∏—Å–∏</option>
                <option value="true" {% if favorite_filter == 'true' %}selected{% endif %}>–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ</option>
            </select>
            
            <button type="submit" class="pink-button py-2 text-black font-bold">
                üîç –ù–∞–π—Ç–∏
            </button>
        </form>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ -->
    <div class="mb-6">
        <a href="{% url 'entry_create' %}" class="pink-button inline-block px-8 py-4 text-xl font-bold text-black">
            ‚úèÔ∏è –ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨
        </a>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π -->
    {% if entries %}
    <div class="space-y-4">
        {% for entry in entries %}
        <div class="card hover:shadow-lg transition-shadow cursor-pointer" onclick="window.location='{% url 'entry_detail' entry.pk %}'">
            <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-black mb-2">
                        {% if entry.title %}
                            {{ entry.title }}
                        {% else %}
                            –ó–∞–ø–∏—Å—å –æ—Ç {{ entry.created_at|date:"d.m.Y" }}
                        {% endif %}
                        {% if entry.is_favorite %}
                            <span class="text-yellow-500">‚≠ê</span>
                        {% endif %}
                    </h3>
                    <p class="text-gray-600 mb-2">
                        {{ entry.created_at|date:"d.m.Y –≤ H:i" }}
                        {% if entry.mood %}
                            | {{ entry.get_mood_display }}
                        {% endif %}
                    </p>
                    <p class="text-gray-800 line-clamp-3">
                        {{ entry.content|truncatewords:30 }}
                    </p>
                    {% if entry.images.first %}
                    <div class="mt-3">
                        <img src="{{ entry.images.first.image.url }}" 
                             alt="–ü—Ä–µ–≤—å—é" 
                             class="w-full h-32 object-cover border-2 border-black rounded-lg">
                        {% if entry.images.count > 1 %}
                        <p class="text-sm text-gray-600 mt-1">+ –µ—â–µ {{ entry.images.count|add:"-1" }} —Ñ–æ—Ç–æ</p>
                        {% endif %}
                    </div>
                    {% endif %}
                    {% if entry.tags %}
                    <div class="mt-3 flex flex-wrap gap-2">
                        {% for tag in entry.get_tags_list %}
                        <span class="bg-pink-200 border border-black rounded-full px-3 py-1 text-sm font-semibold">
                            #{{ tag }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if page_obj.has_other_pages %}
    <div class="mt-8 flex justify-center gap-2">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if mood_filter %}&mood={{ mood_filter }}{% endif %}{% if favorite_filter %}&favorite={{ favorite_filter }}{% endif %}" 
           class="pink-button px-4 py-2 text-black font-bold">
            ‚Üê –ù–∞–∑–∞–¥
        </a>
        {% endif %}
        
        <span class="px-4 py-2 text-black font-semibold">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if mood_filter %}&mood={{ mood_filter }}{% endif %}{% if favorite_filter %}&favorite={{ favorite_filter }}{% endif %}" 
           class="pink-button px-4 py-2 text-black font-bold">
            –í–ø–µ—Ä–µ–¥ ‚Üí
        </a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <div class="card text-center py-12">
        <p class="text-3xl mb-4">üìî</p>
        <p class="text-2xl font-bold text-black mb-4">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>
        <p class="text-lg text-gray-700 mb-6">–ù–∞—á–Ω–∏—Ç–µ –≤–µ—Å—Ç–∏ —Å–≤–æ–π –¥–Ω–µ–≤–Ω–∏–∫ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
        <a href="{% url 'entry_create' %}" class="pink-button inline-block px-8 py-4 text-xl font-bold text-black">
            –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

